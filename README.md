# Streaming Usage Platform

ä¸€ä¸ªç°ä»£åŒ–çš„æµåª’ä½“ä½¿ç”¨ç›‘æ§å¹³å°ï¼Œå¸®åŠ©ç”¨æˆ·è¿½è¸ªå’Œç®¡ç†å¤šä¸ªæµåª’ä½“æœåŠ¡çš„ä½¿ç”¨æƒ…å†µã€æ¶ˆè´¹å’Œé¢„ç®—ã€‚

## ğŸš€ åŠŸèƒ½ç‰¹æ€§

### ğŸ“Š ä½¿ç”¨ç›‘æ§
- **å¤šæœåŠ¡æ”¯æŒ**: Netflixã€Amazon Primeã€Disney+ã€Huluã€HBO Maxã€Spotifyã€Apple Musicã€YouTube Premiumã€Twitch ç­‰
- **å®æ—¶æ•°æ®è¿½è¸ª**: è§‚çœ‹æ—¶é•¿ã€å‰§é›†æ•°é‡ã€æ•°æ®ä½¿ç”¨é‡ç­‰è¯¦ç»†ç»Ÿè®¡
- **å¯è§†åŒ–å›¾è¡¨**: ä½¿ç”¨ ECharts æä¾›ä¸°å¯Œçš„å›¾è¡¨å±•ç¤º
- **æ—¶é—´ç»´åº¦åˆ†æ**: æ”¯æŒæ—¥ã€å‘¨ã€æœˆã€å¹´ç­‰ä¸åŒæ—¶é—´ç»´åº¦çš„æ•°æ®åˆ†æ

### ğŸ’° é¢„ç®—ç®¡ç†
- **é¢„ç®—è®¾ç½®**: ä¸ºä¸åŒæœåŠ¡è®¾ç½®æœˆåº¦/å¹´åº¦é¢„ç®—
- **æ™ºèƒ½å‘Šè­¦**: 50%ã€80%ã€100% é¢„ç®—ä½¿ç”¨ç‡å‘Šè­¦
- **æ¶ˆè´¹åˆ†æ**: è¯¦ç»†çš„æ¶ˆè´¹è¶‹åŠ¿å’Œé¢„ç®—æ‰§è¡Œæƒ…å†µ
- **å¤šå¸ç§æ”¯æŒ**: æ”¯æŒ USDã€EURã€CNY ç­‰å¤šç§è´§å¸

### ğŸ” ç”¨æˆ·ç³»ç»Ÿ
- **å¤šç§ç™»å½•æ–¹å¼**: æ”¯æŒé‚®ç®±å¯†ç å’Œ OAuth ç™»å½•
- **ä¸ªæ€§åŒ–è®¾ç½®**: ç”¨æˆ·åå¥½ã€é€šçŸ¥è®¾ç½®ã€éšç§æ§åˆ¶
- **å¤šè´¦æˆ·ç®¡ç†**: æ”¯æŒåŒä¸€æœåŠ¡çš„å¤šä¸ªè´¦æˆ·

### ğŸ“± ç°ä»£åŒ–ç•Œé¢
- **å“åº”å¼è®¾è®¡**: æ”¯æŒæ¡Œé¢ç«¯å’Œç§»åŠ¨ç«¯
- **æš—è‰²ä¸»é¢˜**: åŸºäº Tailwind CSS çš„ç°ä»£åŒ– UI
- **æµç•…åŠ¨ç”»**: ä½¿ç”¨ Framer Motion æä¾›æµç•…çš„ç”¨æˆ·ä½“éªŒ
- **å®æ—¶æ›´æ–°**: åŸºäº React Query çš„æ•°æ®å®æ—¶åŒæ­¥

## ğŸ›  æŠ€æœ¯æ ˆ

### å‰ç«¯
- **æ¡†æ¶**: Next.js 15.3.3 (App Router)
- **UI åº“**: React 19 + Ant Design 5.26.2
- **æ ·å¼**: Tailwind CSS 4
- **çŠ¶æ€ç®¡ç†**: Zustand 5.0.5
- **æ•°æ®è·å–**: TanStack React Query 5.80.7
- **è¡¨å•å¤„ç†**: React Hook Form 7.58.1 + Zod 3.25.67
- **å›¾è¡¨**: ECharts 5.6.0
- **åŠ¨ç”»**: Framer Motion 12.18.1

### åç«¯
- **æ•°æ®åº“**: MySQL 8.0 (ä¸»æ•°æ®åº“) + InfluxDB 2.0 (æ—¶åºæ•°æ®)
- **ç¼“å­˜**: Redis 7
- **ORM**: Prisma 6.10.0
- **è®¤è¯**: NextAuth.js 4.24.11
- **API**: Next.js API Routes

### éƒ¨ç½²
- **å®¹å™¨åŒ–**: Docker + Docker Compose
- **æ•°æ®åº“ç®¡ç†**: Adminer 4.8.1

## ğŸ“¦ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Node.js 18+ 
- Docker & Docker Compose
- Git

### 1. å…‹éš†é¡¹ç›®
```bash
git clone <repository-url>
cd streaming-usage-platform
```

### 2. å®‰è£…ä¾èµ–
```bash
npm install
```

### 3. ç¯å¢ƒé…ç½®
åˆ›å»º `.env.local` æ–‡ä»¶ï¼š
```env
# æ•°æ®åº“é…ç½®
DATABASE_URL="mysql://streaming_user:streaming_pass_123@localhost:3306/streaming_usage"

# NextAuth é…ç½®
NEXTAUTH_SECRET=your-super-secret-key-here
NEXTAUTH_URL=http://localhost:4000

# InfluxDB é…ç½®
INFLUX_URL=http://localhost:8086
INFLUX_TOKEN=my_super_secret_admin_token_123456789
INFLUX_ORG=streaming-org
INFLUX_BUCKET=usage-data

# Redis é…ç½®
REDIS_URL=redis://:redis_pass_123@localhost:6379
```

### 4. å¯åŠ¨æœåŠ¡
```bash
# ä¸€é”®å¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼ˆæ¨èï¼‰
npm run setup-db

# æˆ–è€…åˆ†æ­¥å¯åŠ¨
docker-compose up -d
```

### 5. æ•°æ®åº“è¿ç§»
```bash
# ç”Ÿæˆ Prisma å®¢æˆ·ç«¯
npx prisma generate

# è¿è¡Œæ•°æ®åº“è¿ç§»
npx prisma migrate dev
```

### 6. å¯åŠ¨åº”ç”¨
```bash
npm run dev
```

è®¿é—® http://localhost:4000 æŸ¥çœ‹åº”ç”¨ã€‚

## ğŸ— é¡¹ç›®ç»“æ„

```
streaming-usage-platform/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                    # Next.js App Router
â”‚   â”‚   â”œâ”€â”€ actions/           # Server Actions
â”‚   â”‚   â”‚   â””â”€â”€ auth.ts        # è®¤è¯ç›¸å…³æ“ä½œ
â”‚   â”‚   â”œâ”€â”€ api/               # API è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ auth/          # è®¤è¯ API
â”‚   â”‚   â”‚   â”œâ”€â”€ data/          # æ•°æ® API
â”‚   â”‚   â”‚   â””â”€â”€ init-data/     # æ•°æ®åˆå§‹åŒ– API
â”‚   â”‚   â”œâ”€â”€ auth/              # è®¤è¯é¡µé¢
â”‚   â”‚   â”‚   â”œâ”€â”€ login/         # ç™»å½•é¡µé¢
â”‚   â”‚   â”‚   â””â”€â”€ register/      # æ³¨å†Œé¡µé¢
â”‚   â”‚   â”œâ”€â”€ monitoring/        # ç›‘æ§é¡µé¢
â”‚   â”‚   â”œâ”€â”€ usage/             # ä½¿ç”¨ç»Ÿè®¡é¡µé¢
â”‚   â”‚   â”œâ”€â”€ globals.css        # å…¨å±€æ ·å¼
â”‚   â”‚   â”œâ”€â”€ layout.tsx         # æ ¹å¸ƒå±€
â”‚   â”‚   â”œâ”€â”€ page.tsx           # é¦–é¡µ
â”‚   â”‚   â””â”€â”€ providers.tsx      # å…¨å±€ Provider
â”‚   â”œâ”€â”€ lib/                   # å·¥å…·åº“
â”‚   â”‚   â”œâ”€â”€ auth/              # è®¤è¯é…ç½®
â”‚   â”‚   â”œâ”€â”€ db/                # æ•°æ®åº“é…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ prisma.ts      # Prisma å®¢æˆ·ç«¯
â”‚   â”‚   â”‚   â””â”€â”€ redis.ts       # Redis å®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ theme.ts           # ä¸»é¢˜é…ç½®
â”‚   â”‚   â””â”€â”€ utils.ts           # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ types/                 # TypeScript ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ middleware.ts          # ä¸­é—´ä»¶
â”œâ”€â”€ prisma/                    # æ•°æ®åº“é…ç½®
â”‚   â”œâ”€â”€ schema.prisma          # æ•°æ®åº“æ¨¡å‹
â”‚   â””â”€â”€ migrations/            # æ•°æ®åº“è¿ç§»
â”œâ”€â”€ docker/                    # Docker é…ç½®
â”‚   â”œâ”€â”€ mysql/                 # MySQL é…ç½®
â”‚   â”œâ”€â”€ influxdb/              # InfluxDB é…ç½®
â”‚   â””â”€â”€ redis/                 # Redis é…ç½®
â”œâ”€â”€ scripts/                   # è„šæœ¬æ–‡ä»¶
â”œâ”€â”€ public/                    # é™æ€èµ„æº
â”œâ”€â”€ docker-compose.yml         # Docker æœåŠ¡é…ç½®
â”œâ”€â”€ tailwind.config.ts         # Tailwind é…ç½®
â”œâ”€â”€ next.config.ts             # Next.js é…ç½®
â””â”€â”€ package.json               # é¡¹ç›®é…ç½®
```

## ğŸ—„ æ•°æ®åº“è®¾è®¡

### æ ¸å¿ƒæ¨¡å‹

#### User (ç”¨æˆ·)
- åŸºæœ¬ä¿¡æ¯ï¼šé‚®ç®±ã€å§“åã€å¤´åƒ
- è®¤è¯ä¿¡æ¯ï¼šå¯†ç ã€é‚®ç®±éªŒè¯
- å…³è”ï¼šè´¦æˆ·ã€ä¼šè¯ã€åå¥½è®¾ç½®ã€é¢„ç®—ã€ä½¿ç”¨è®°å½•

#### StreamingAccount (æµåª’ä½“è´¦æˆ·)
- æœåŠ¡ç±»å‹ï¼šNetflixã€Disney+ ç­‰
- è®¢é˜…ä¿¡æ¯ï¼šæœˆè´¹ã€å¸ç§ã€è´¦å•æ—¥æœŸ
- API é›†æˆï¼šAPI å¯†é’¥ã€ç”¨æˆ·å
- å…³è”ï¼šç”¨æˆ·ã€ä½¿ç”¨è®°å½•

#### UsageRecord (ä½¿ç”¨è®°å½•)
- ä½¿ç”¨æ•°æ®ï¼šæ—¥æœŸã€æ—¶é•¿ã€å‰§é›†æ•°ã€æ•°æ®ä½¿ç”¨é‡
- å†…å®¹ä¿¡æ¯ï¼šç±»å‹ã€åˆ†ç±»ã€è´¨é‡
- å…³è”ï¼šç”¨æˆ·ã€è´¦æˆ·

#### Budget (é¢„ç®—)
- é¢„ç®—ä¿¡æ¯ï¼šåç§°ã€é‡‘é¢ã€å¸ç§ã€å‘¨æœŸ
- å‘Šè­¦è®¾ç½®ï¼š50%ã€80%ã€100% å‘Šè­¦é˜ˆå€¼
- å…³è”ï¼šç”¨æˆ·

## ğŸ”Œ API æ¥å£

### è®¤è¯ç›¸å…³
- `POST /api/auth/login` - ç”¨æˆ·ç™»å½•
- `POST /api/auth/register` - ç”¨æˆ·æ³¨å†Œ
- `GET /api/auth/session` - è·å–ä¼šè¯ä¿¡æ¯

### æ•°æ®ç›¸å…³
- `GET /api/data/usage` - è·å–ä½¿ç”¨æ•°æ®
- `POST /api/data/usage` - æ·»åŠ ä½¿ç”¨è®°å½•
- `GET /api/data/budget` - è·å–é¢„ç®—ä¿¡æ¯
- `POST /api/data/budget` - åˆ›å»ºé¢„ç®—

### åˆå§‹åŒ–
- `POST /api/init-data` - åˆå§‹åŒ–æµ‹è¯•æ•°æ®

## ğŸ¨ ç•Œé¢é¢„è§ˆ

### ä¸»è¦é¡µé¢
- **é¦–é¡µ**: æ¦‚è§ˆä»ªè¡¨æ¿ï¼Œæ˜¾ç¤ºå…³é”®æŒ‡æ ‡
- **ç›‘æ§é¡µé¢**: è¯¦ç»†çš„ä½¿ç”¨æ•°æ®å›¾è¡¨
- **ä½¿ç”¨ç»Ÿè®¡**: æŒ‰æœåŠ¡åˆ†ç±»çš„ä½¿ç”¨æƒ…å†µ
- **é¢„ç®—ç®¡ç†**: é¢„ç®—è®¾ç½®å’Œæ¶ˆè´¹åˆ†æ
- **ç”¨æˆ·è®¾ç½®**: ä¸ªäººåå¥½å’Œé€šçŸ¥è®¾ç½®

### ç‰¹è‰²åŠŸèƒ½
- **å®æ—¶å›¾è¡¨**: ä½¿ç”¨ ECharts å±•ç¤ºæ•°æ®è¶‹åŠ¿
- **å“åº”å¼å¸ƒå±€**: é€‚é…å„ç§å±å¹•å°ºå¯¸
- **æš—è‰²ä¸»é¢˜**: æŠ¤çœ¼çš„æš—è‰²ç•Œé¢
- **æµç•…åŠ¨ç”»**: é¡µé¢åˆ‡æ¢å’Œäº¤äº’åŠ¨ç”»

## ğŸš€ éƒ¨ç½²

### å¼€å‘ç¯å¢ƒ
```bash
npm run dev
```

### ç”Ÿäº§ç¯å¢ƒ
```bash
# æ„å»ºåº”ç”¨
npm run build

# å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
npm start
```

### Docker éƒ¨ç½²
```bash
# æ„å»ºé•œåƒ
docker build -t streaming-usage-platform .

# å¯åŠ¨æœåŠ¡
docker-compose up -d
```

## ğŸ”§ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°çš„æµåª’ä½“æœåŠ¡
1. åœ¨ `prisma/schema.prisma` ä¸­çš„ `StreamingService` æšä¸¾æ·»åŠ æ–°æœåŠ¡
2. è¿è¡Œ `npx prisma migrate dev` æ›´æ–°æ•°æ®åº“
3. åœ¨ç›¸å…³ç»„ä»¶ä¸­æ·»åŠ æ–°æœåŠ¡çš„å›¾æ ‡å’Œé…ç½®

### è‡ªå®šä¹‰å›¾è¡¨
1. åœ¨ `src/app/monitoring/components/` ä¸­åˆ›å»ºæ–°çš„å›¾è¡¨ç»„ä»¶
2. ä½¿ç”¨ ECharts é…ç½®å›¾è¡¨æ ·å¼
3. åœ¨é¡µé¢ä¸­é›†æˆæ–°ç»„ä»¶

### æ·»åŠ æ–°çš„æ•°æ®å­—æ®µ
1. æ›´æ–° Prisma schema
2. è¿è¡Œæ•°æ®åº“è¿ç§»
3. æ›´æ–°ç›¸å…³çš„ API å’Œç»„ä»¶

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥ Docker æœåŠ¡çŠ¶æ€
   docker-compose ps
   
   # é‡å¯æ•°æ®åº“æœåŠ¡
   docker-compose restart mysql influxdb redis
   ```

2. **Prisma å®¢æˆ·ç«¯é”™è¯¯**
   ```bash
   # é‡æ–°ç”Ÿæˆå®¢æˆ·ç«¯
   npx prisma generate
   
   # é‡ç½®æ•°æ®åº“
   npx prisma migrate reset
   ```

3. **ç«¯å£å†²çª**
   ```bash
   # æ£€æŸ¥ç«¯å£å ç”¨
   lsof -i :4000
   
   # ä¿®æ”¹ docker-compose.yml ä¸­çš„ç«¯å£æ˜ å°„
   ```

### æ—¥å¿—æŸ¥çœ‹
```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
npm run dev

# æŸ¥çœ‹ Docker æœåŠ¡æ—¥å¿—
docker-compose logs -f

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—
docker logs streaming-mysql
docker logs streaming-influxdb
docker logs streaming-redis
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### æ•°æ®åº“ä¼˜åŒ–
- ä½¿ç”¨ InfluxDB å­˜å‚¨æ—¶åºæ•°æ®
- Redis ç¼“å­˜çƒ­ç‚¹æ•°æ®
- æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–

### å‰ç«¯ä¼˜åŒ–
- React Query æ•°æ®ç¼“å­˜
- ç»„ä»¶æ‡’åŠ è½½
- å›¾ç‰‡ä¼˜åŒ–

### ç›‘æ§æŒ‡æ ‡
- é¡µé¢åŠ è½½æ—¶é—´
- API å“åº”æ—¶é—´
- æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. æ‰“å¼€ Pull Request

### ä»£ç è§„èŒƒ
- ä½¿ç”¨ TypeScript ä¸¥æ ¼æ¨¡å¼
- éµå¾ª ESLint å’Œ Prettier é…ç½®
- ç¼–å†™å•å…ƒæµ‹è¯•
- æ›´æ–°ç›¸å…³æ–‡æ¡£

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ™ è‡´è°¢

- [Next.js](https://nextjs.org/) - React æ¡†æ¶
- [Ant Design](https://ant.design/) - UI ç»„ä»¶åº“
- [Prisma](https://www.prisma.io/) - æ•°æ®åº“ ORM
- [ECharts](https://echarts.apache.org/) - å›¾è¡¨åº“
- [Tailwind CSS](https://tailwindcss.com/) - CSS æ¡†æ¶

## ğŸ“ æ”¯æŒ

å¦‚æœæ‚¨é‡åˆ°é—®é¢˜æˆ–æœ‰å»ºè®®ï¼Œè¯·ï¼š

1. æŸ¥çœ‹ [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤) éƒ¨åˆ†
2. æœç´¢ç°æœ‰çš„ [Issues](../../issues)
3. åˆ›å»ºæ–°çš„ Issue æè¿°é—®é¢˜
4. è”ç³»é¡¹ç›®ç»´æŠ¤è€…

---

**Streaming Usage Platform** - è®©æµåª’ä½“ä½¿ç”¨æ›´é€æ˜ã€æ›´æ™ºèƒ½ ğŸ¬ 